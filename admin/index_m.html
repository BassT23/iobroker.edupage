<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <title>EduPage</title>

  <!-- MUST be absolute, NOT relative -->
  <script src="/adminWww/js/adapter-settings.js"></script>

  <style>
    .adapter-container {
      max-width: 700px;
    }
    .header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }
    .logo {
      width: 64px;
      height: 64px;
      margin-right: 16px;
    }
    label {
      display: block;
      margin-top: 12px;
    }
    input[type="text"],
    input[type="password"],
    input[type="number"] {
      width: 100%;
    }
  </style>
</head>

<body>
  <div class="adapter-container">
    <div class="header">
      <img src="edupage.png" class="logo">
      <h5 class="translate">EduPage settings</h5>
    </div>

    <label class="translate">Base URL</label>
    <input class="value" id="baseUrl" type="text">

    <label class="translate">Username</label>
    <input class="value" id="username" type="text">

    <label class="translate">Password</label>
    <input class="value" id="password" type="password">

    <label class="translate">Refresh interval (minutes)</label>
    <input class="value" id="intervalMin" type="number" min="5">

    <label class="translate">Max lessons per day</label>
    <input class="value" id="maxLessons" type="number" min="6">

    <p>
      <label>
        <input class="value" id="enableWeek" type="checkbox">
        <span class="translate">Week view</span>
      </label>
    </p>
  </div>

  <script>
    function load(settings, onChange) {
      settings = settings || {};

      document.querySelectorAll('.value').forEach(el => {
        if (el.type === 'checkbox') {
          el.checked = !!settings[el.id];
        } else {
          el.value = settings[el.id] ?? '';
        }
        el.addEventListener('change', () => onChange(true));
        el.addEventListener('input', () => onChange(true));
      });

      onChange(false);
    }

    function save(callback) {
      const obj = {};
      document.querySelectorAll('.value').forEach(el => {
        if (el.type === 'checkbox') {
          obj[el.id] = el.checked;
        } else if (el.type === 'number') {
          obj[el.id] = parseInt(el.value, 10) || 0;
        } else {
          obj[el.id] = el.value;
        }
      });
      callback(obj);
    }
  </script>
</body>
</html>
